{% extends "base.html" %}

{% block title %}Indicadores Ambientales - Sistema de Gestión Ambiental{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="bi bi-graph-up"></i> Indicadores Ambientales</h1>
</div>

<!-- Indicadores actuales -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-speedometer"></i> Indicadores del Mes Actual
            </div>
            <div class="card-body">
                {% if indicadores %}
                <div class="row">
                    {% for key, ind in indicadores.items() %}
                    <div class="col-md-4 mb-3">
                        <div class="card indicator-card">
                            <div class="card-body">
                                <h6 class="text-muted mb-2">{{ ind.descripcion }}</h6>
                                <div class="indicator-value">{{ "%.2f"|format(ind.valor) }} <small class="text-muted">{{ ind.unidad }}</small></div>
                                {% if ind.meta %}
                                <div class="mt-2">
                                    <small class="text-muted">Meta: {{ "%.2f"|format(ind.meta) }} {{ ind.unidad }}</small>
                                    {% if ind.valor <= ind.meta %}
                                    <span class="badge bg-success ms-2">Cumplido</span>
                                    {% else %}
                                    <span class="badge bg-warning ms-2">Por mejorar</span>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="alert alert-info text-center">
                    <i class="bi bi-info-circle"></i> No hay datos suficientes para calcular indicadores del mes actual. 
                    <br>Agregue registros de producción, consumos y residuos para ver los indicadores.
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Histórico de indicadores -->
<div class="card">
    <div class="card-header">
        <i class="bi bi-clock-history"></i> Histórico de Indicadores
    </div>
    <div class="card-body">
        {% if historicos %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Indicador</th>
                        <th>Valor</th>
                        <th>Unidad</th>
                        <th>Meta</th>
                        <th>Observaciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for hist in historicos %}
                    <tr>
                        <td>{{ hist.fecha.strftime('%d/%m/%Y') }}</td>
                        <td><strong>{{ hist.indicador }}</strong></td>
                        <td>{{ "%.2f"|format(hist.valor) }}</td>
                        <td>{{ hist.unidad or '-' }}</td>
                        <td>
                            {% if hist.meta %}
                            {{ "%.2f"|format(hist.meta) }}
                            {% else %}
                            -
                            {% endif %}
                        </td>
                        <td>{{ hist.observaciones or '-' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-muted text-center py-4">No hay registros históricos de indicadores.</p>
        {% endif %}
    </div>
</div>

<!-- Información sobre ODS -->
<div class="card mt-4">
    <div class="card-header">
        <i class="bi bi-globe"></i> Relación con Objetivos de Desarrollo Sostenible (ODS)
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <h6><i class="bi bi-droplet"></i> ODS 6: Agua Limpia y Saneamiento</h6>
                <p class="small text-muted">Monitoreo del consumo de agua y gestión de efluentes alcalinos.</p>
            </div>
            <div class="col-md-6">
                <h6><i class="bi bi-lightning-charge"></i> ODS 7: Energía Asequible y No Contaminante</h6>
                <p class="small text-muted">Seguimiento del consumo energético y eficiencia del proceso.</p>
            </div>
            <div class="col-md-6">
                <h6><i class="bi bi-arrow-repeat"></i> ODS 12: Producción y Consumo Responsables</h6>
                <p class="small text-muted">Economía circular, reciclaje y reducción de residuos.</p>
            </div>
            <div class="col-md-6">
                <h6><i class="bi bi-tree"></i> ODS 13: Acción por el Clima</h6>
                <p class="small text-muted">Reducción de emisiones y optimización de recursos.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

